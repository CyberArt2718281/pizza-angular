# Роутинг в Angular (на примере проекта pizza-angular)

## Основные понятия

- **Роутинг** — система навигации между компонентами приложения по URL.
- **Маршрут (Route)** — объект, связывающий путь (path) с компонентом.
- **RouterModule** — модуль Angular для настройки роутинга.
- **Guard** — механизм защиты маршрутов (например, для авторизации).

## Настройка маршрутов (app-routing.module.ts)

```typescript
const routes: Routes = [
  { path: '', component: MainComponent },
  { path: 'about', component: AboutComponent },
  { path: 'products', component: ProductsComponent },
  { path: 'pizzas', redirectTo: '/products' },
  { path: 'products/:id', component: ProductComponent },
  { path: 'order', component: OrderComponent, canActivate: [AuthGuard] },
  { path: '**', redirectTo: '' }
];
```

- `''` — главная страница.
- `'about'` — страница "О нас".
- `'products'` — список продуктов.
- `'products/:id'` — страница отдельного продукта (динамический параметр).
- `'order'` — оформление заказа, защищено guard'ом.
- `'pizzas'` — редирект на `/products`.
- `**` — wildcard, редирект на главную при неизвестном пути.

## Варианты работы с текущим URL и параметрами

- **Используя подписку на Observable** — подписка на изменения параметров маршрута в реальном времени.
- **Используя snapShot (снимок состояния)** — получение параметров на момент активации маршрута.

## Guards для роутов

Механизм для выполнения проверок перед активацией и деактивацией маршрута.

### Виды Guards

- **resolve** — назначает guard, которые откладывают активацию маршрута до завершения какого-либо асинхронного действия.
- **canActivate** — назначает guard, которые проверяют, может ли маршрут быть активирован.
- **canActivateChild** — назначает guard, которые проверяют, может ли дочерний маршрут быть активирован.
- **canDeactivate** — назначает guards, которые проверяют, может ли маршрут быть деактивирован.
- **canLoad** — назначает guard, которые проверяют, может ли модуль быть загружен.

## AuthGuard (auth.guard.ts)

- Реализует интерфейс `CanActivate`.
- Проверяет, авторизован ли пользователь через сервис `AuthService`.
- Если не авторизован — редирект на главную.

```typescript
canActivate(
  route: ActivatedRouteSnapshot,
  state: RouterStateSnapshot
): boolean | UrlTree {
  if (this.authService.isLoggedIn()) {
    return true;
  } else {
    this.router.navigate(['/']);
    return false;
  }
}
```

## AuthService (auth.service.ts)

Простой сервис для управления состоянием аутентификации с булевым флагом.

```typescript
export class AuthService {
  private isLogged = false;

  login() { this.isLogged = true; }
  logOut() { this.isLogged = false; }
  isLoggedIn(): boolean { return this.isLogged; }
}
```

## Работа с параметрами маршрута

В компоненте `ProductComponent` используется подписка на параметры:

```typescript
ngOnInit(): void {
  this.activatedRoute.params.subscribe(params => {
    if (params['id']) {
      const product = this.productService.getProduct(+params['id']);
      if (product) {
        this.product = product;
      } else {
        this.router.navigate(['/']);
      }
    }
  });
}
```

## LocationStrategy

Provider для управления стратегией URL.

- **PathLocationStrategy** — стандартный HTML pushState (по умолчанию).
- **HashLocationStrategy** — стиль hash URL (например, `/#/about`).

## Интеграция в модуль (app.module.ts)

AppRoutingModule импортируется в AppModule для активации роутинга.

```typescript
@NgModule({
  imports: [BrowserModule, AppRoutingModule, FormsModule, NgOptimizedImage],
  // ...
})
export class AppModule {}
```

## Дополнительные возможности

- **anchorScrolling: 'enabled'** — прокрутка к якорям при переходе по ссылкам.

## Использование RouterLink в шаблонах

В Angular для навигации используются директивы `RouterLink` и `RouterLinkActive`.

### RouterLink

Директива для создания ссылок на маршруты. Пример из `header.component.html`:

```html
<a [routerLink]="''" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">Главная</a>
<a [routerLink]="'products'" routerLinkActive="active">Пиццы</a>
<a [routerLink]="'/about'" routerLinkActive="active">О нас</a>
<a [routerLink]="'order'" routerLinkActive="active">Сделать заказ</a>
```

- `[routerLink]="''"` — ссылка на корневой маршрут.
- `[routerLink]="'products'"` — относительная ссылка.
- `[routerLink]="'/about'"` — абсолютная ссылка.

### RouterLink с массивами для параметров

RouterLink может принимать массив строк для построения пути с параметрами. Пример из `product-card.component.html`:

```html
<a [routerLink]="['/products', product.id]">подробнее</a>
```

Это эквивалентно `/products/${product.id}`.

### RouterLinkActive

Директива для добавления CSS-класса активной ссылке.

- `routerLinkActive="active"` — добавляет класс `active` при совпадении маршрута.
- `[routerLinkActiveOptions]="{exact: true}"` — точное совпадение (для главной страницы).

## Router-outlet

Компонент `<router-outlet></router-outlet>` в `app.component.html` определяет место, где будут отображаться компоненты маршрутов.

```html
<app-header></app-header>
<router-outlet></router-outlet>
<app-footer></app-footer>
```

## Программная навигация с Router.navigate

Для навигации из TypeScript-кода используется `Router.navigate()`.

Примеры:

- В `ProductComponent` при отсутствии продукта:
  ```typescript
  this.router.navigate(['/']);
  ```

- В `ProductsComponent` при добавлении в корзину:
  ```typescript
  this.router.navigate(['/order'], {queryParams: {product-card: data.title}});
  ```

### QueryParams

`queryParams` позволяют передавать дополнительные параметры в URL.

Пример: `{queryParams: {product-card: data.title}}` добавляет `?product-card=title` к URL.

### Дополнительные примеры queryParams

Из `product-card.component.html`:

```html
<a [routerLink]="'/order'" [queryParams]="{product: product.title}">В корзину</a>
```

Из `order.component.html`:

```html
<a routerLink="/order" [queryParams]="{product:'test'}">Хватит думать!</a>
```

QueryParams добавляют параметры к URL, например: `/order?product=Название%20пиццы`.

## Навигация в компонентах

В `header.component.html` используется навигация с RouterLinkActive для выделения активных ссылок.

## Структура приложения с роутингом

Приложение использует общий header и footer, а содержимое страниц рендерится через `<router-outlet>`.

## Итог

Роутинг в Angular позволяет:
- Организовать навигацию между страницами.
- Использовать динамические параметры.
- Защищать маршруты с помощью guard'ов.
- Управлять прокруткой и стратегией отображения URL.
